# Scrapbox記法仕様書 (Scrapbox Syntax Specification)

Version: 1.0

Last Updated: 2026-01-22

注意: Scrapboxの機能は継続的に更新されるため、将来的に本仕様書の内容が実際の動作と乖離する可能性がある。

## 1 Introduction

### 1.1 Scrapboxとは

Scrapbox（Cosense）は、独自のマークアップ言語を採用したナレッジベースシステムである。本仕様書は、Scrapbox記法の正確な構文と動作を定義する。

### 1.2 Scrapbox記法とは

Scrapbox記法は、小さな文書同士の関係性を宣言し、より大きく複雑な情報構造を表現することを目的として設計されている。1つの大きなページ内で見出しを作り長文を構造化するのではなく、複数の小さなページをリンクで結びつける設計思想を持つ。

## 2 Preliminaries

### 2.1 文字

Scrapboxは UTF-8 エンコーディングを使用する。すべての Unicode 文字が有効である。

### 2.2 行

行は改行文字 (U+000A LINE FEED) で区切られる。各行は独立して処理される。

### 2.3 ブラケット

Scrapbox記法の中核となる構文要素は**ブラケット** (bracket) である。左ブラケット `[` (U+005B) と右ブラケット `]` (U+005D) で囲まれたテキストは、その内容に応じて異なる意味を持つ。

## 3 ブロック要素

### 3.1 段落

#### 3.1.1

インデントを持たない通常のテキスト行は**段落** (paragraph) として扱われる。

**Example 1:**

入力:

```txt
これは段落です。
```

出力: 通常のテキストとして表示される。

### 3.2 箇条書き

#### 3.2.1

行頭にスペース文字 (U+0020) またはタブ文字 (U+0009) を配置することで、その行は**箇条書き** (bulleted list item) となる。

#### 3.2.2

インデントレベルは行頭の空白文字の数によって決定される。1つ以上の空白文字で1レベルのインデントとなる。

**Example 2:**

入力:

```txt
通常の行
 レベル1の箇条書き
  レベル2の箇条書き
   レベル3の箇条書き
```

出力: 階層構造を持つ箇条書きとして表示される。

#### 3.2.3

Scrapboxは任意の深さのネストをサポートするが、Notion等の他システムへの変換時には制限が存在する場合がある。

### 3.3 コードブロック

#### 3.3.1

`code:` で始まる行の後に、インデントされた複数行が続く場合、それは**コードブロック** (code block) として扱われる。

**Example 3:**

入力:

```txt
code:example.js
 function hello() {
   console.log("Hello");
 }
```

出力: シンタックスハイライトされたコードブロックとして表示される。

#### 3.3.2

`code:` の後に続く文字列は、言語名またはファイル名として解釈される。ファイル名の場合、拡張子から言語が推論される。

**Example 4:**

入力:

```txt
code:python
 print("Hello")
```

出力: Python のシンタックスハイライトが適用される。

#### 3.3.3

言語名として以下が使用可能である（一部）:

- `javascript`, `js`
- `python`, `py`
- `ruby`, `rb`
- `java`
- `c`, `cpp`, `c++`
- その他多数

#### 3.3.4

同一ページ内に同じファイル名のコードブロックが複数存在する場合、それらは連結されて1つのファイルとして扱われる。

#### 3.3.5

ファイル名を持つコードブロックは、次の URL 形式でアクセス可能である:

```txt
https://scrapbox.io/api/code/{project}/{page_title}/{code_name}
```

### 3.4 テーブル

#### 3.4.1

`table:` で始まる行の後に、タブ文字で区切られたインデントされた複数行が続く場合、それは**テーブル** (table) として扱われる。

**Example 5:**

入力:

```txt
table:サンプル
 列1 列2 列3
 A B C
 1 2 3
```

出力: テーブルとして表示される。

#### 3.4.2

各行はタブ文字 (U+0009) で列に分割される。最初の行がヘッダーとして扱われる。

### 3.5 引用

#### 3.5.1

行頭が `>` (U+003E GREATER-THAN SIGN) で始まり、その後に空白文字が続く行は**引用** (quote) として扱われる。

**Example 6:**

入力:

```txt
> これは引用です。
```

出力: 引用スタイルで表示される。

### 3.6 数式ブロック

#### 3.6.1

言語名として `tex` または `latex` を指定したコードブロックは、**数式ブロック** (math block) として扱われ、TeX/LaTeX 記法がレンダリングされる。

**Example 7:**

入力:

```txt
code:tex
 \frac{-b \pm \sqrt{b^2-4ac}}{2a}
```

出力: レンダリングされた数式として表示される。

### 3.7 Mermaid図

#### 3.7.1

言語名として `mermaid` または `mmd` を指定したコードブロックは、**Mermaid図** (Mermaid diagram) として扱われる。

**Example 8:**

入力:

```txt
code:mermaid
 flowchart LR
     A-->B
```

出力: レンダリングされたフローチャートとして表示される。

### 3.8 コールアウト

#### 3.8.1

行頭が `?` (U+003F QUESTION MARK) で始まり、その後に空白文字が続く行は**コールアウト** (callout) として扱われる。これはHelpfeel記法とも呼ばれる。

**Example 9:**

入力:

```txt
? よくある質問の内容
```

出力: ハイライトされたコールアウトとして表示される。

### 3.9 コマンドライン

#### 3.9.1

行頭が `$` (U+0024 DOLLAR SIGN) または `%` (U+0025 PERCENT SIGN) で始まる行は**コマンドライン** (command line) として扱われる。

**Example 10:**

入力:

```txt
$ git status
% ls -la
```

出力: コマンドラインスタイルで表示される。

## 4 インライン要素

### 4.1 ページリンク

#### 4.1.1

ブラケットで囲まれたテキストが、URL、画像URL、その他の特殊な記法に該当しない場合、それは**ページリンク** (page link) として扱われる。

**Example 11:**

入力:

```txt
[ページタイトル]
```

出力: 同一プロジェクト内の「ページタイトル」というページへのリンク。

#### 4.1.2

リンク先のページが存在しない場合、そのリンクは**空リンク** (empty link) として扱われ、異なる色（通常はオレンジ色）で表示される。

#### 4.1.3

ページタイトルに空白文字や特殊文字を含むことができる。

### 4.2 フラグメント付きリンク

#### 4.2.1

ページリンクに `#` (U+0023 NUMBER SIGN) が含まれる場合、`#` 以降の部分は**フラグメント** (fragment) として扱われる。

**Example 12:**

入力:

```txt
[ページタイトル#セクション名]
```

出力: ページ内の特定セクションへのリンク。

### 4.3 クロスプロジェクトリンク

#### 4.3.1

ブラケット内のテキストが `/` (U+002F SOLIDUS) で始まる場合、それは**クロスプロジェクトリンク** (cross-project link) として扱われる。

**Example 13:**

入力:

```txt
[/project-name/page-title]
```

出力: `project-name` プロジェクトの `page-title` ページへのリンク。

#### 4.3.2

クロスプロジェクトリンクもフラグメントをサポートする。

**Example 14:**

入力:

```txt
[/project/page#section]
```

出力: 他プロジェクトのページ内セクションへのリンク。

#### 4.3.3

`.icon` で終わらないクロスプロジェクトリンクは、Scrapbox URL へのリンクに変換される:

```txt
https://scrapbox.io/{project}/{page}
```

### 4.4 外部リンク

#### 4.4.1

ブラケット内のテキストが `http://` または `https://` で始まる場合、それは**外部リンク** (external link) として扱われる。

**Example 15:**

入力:

```txt
[https://example.com]
```

出力: <https://example.com> へのリンク。

#### 4.4.2

ブラケット内に URL と表示テキストが空白文字で区切られて存在する場合、表示テキスト付きの外部リンクとなる。URL と表示テキストの順序はどちらでも良い。

**Example 16:**

入力:

```txt
[https://example.com Example Site]
[Example Site https://example.com]
```

出力: 「Example Site」という表示テキストで <https://example.com> へのリンク。

#### 4.4.3

ブラケットなしで行に URL が単独で記述された場合も、自動的にリンクとして扱われる。

**Example 17:**

入力:

```txt
https://example.com
```

出力: <https://example.com> へのリンク。

### 4.5 ハッシュタグ

#### 4.5.1

`#` (U+0023 NUMBER SIGN) で始まり、その後に空白を含まないテキストが続く場合、それは**ハッシュタグ** (hashtag) として扱われる。

**Example 18:**

入力:

```txt
#タグ名
#tag-name
```

出力: タグ名へのリンク（ページリンクと同等の機能）。

#### 4.5.2

ハッシュタグはページリンクと同じ機能を持つが、視覚的な表示が異なる。内部的にはリンクとして扱われ、関連ページリストにも反映される。

### 4.6 画像

#### 4.6.1

ブラケット内のテキストが画像URLである場合（`.png`, `.jpg`, `.jpeg`, `.gif`, `.svg`, `.webp` 等の拡張子を持つURL、またはGyazo URL）、それは**画像** (image) として扱われる。

**Example 19:**

入力:

```txt
[https://example.com/image.png]
[https://gyazo.com/abc123]
```

出力: 画像として表示される。

#### 4.6.2

ブラケットを二重にすることで、**大きな画像** (large image) として表示される（横幅いっぱい、高さ制限なし）。

**Example 20:**

入力:

```txt
[[https://example.com/image.png]]
```

出力: 大きなサイズで画像が表示される。

#### 4.6.3

Gyazo URL の形式:

```txt
https://gyazo.com/{image_id}
https://i.gyazo.com/{image_id}.{ext}
```

### 4.7 リンク付き画像

#### 4.7.1

ブラケット内にリンクURLと画像URLが空白文字で区切られて存在する場合、それは**リンク付き画像** (linked image) として扱われる。順序はどちらでも良い。

**Example 21:**

入力:

```txt
[https://example.com https://example.com/image.png]
[https://example.com/image.png https://example.com]
```

出力: クリックすると <https://example.com> に遷移する画像。

### 4.8 アイコン記法

#### 4.8.1

ブラケット内のテキストが `.icon` で終わる場合、それは**アイコン記法** (icon notation) として扱われる。

**Example 22:**

入力:

```txt
[page-name.icon]
```

出力: `page-name` ページのページタイトル画像が、インラインアイコンとして表示される。

#### 4.8.2

アイコン記法はクロスプロジェクトもサポートする。

**Example 23:**

入力:

```txt
[/icons/icon-name.icon]
```

出力: `/icons` プロジェクトの `icon-name` ページのアイコンが表示される。

#### 4.8.3

アイコンの連打記法: `*` の後に数字を指定することで、同じアイコンを複数回表示できる。

**Example 24:**

入力:

```txt
[user.icon*3]
```

出力: `user` のアイコンが3つ連続で表示される。

### 4.9 Location記法

#### 4.9.1

ブラケット内のテキストが `N{latitude},E{longitude}` の形式を含む場合、それは**Location記法** (location notation) として扱われ、地図として表示される。

**Example 25:**

入力:

```txt
[N35.6582536,E139.7443415,Z15 東京タワー]
[東京タワー N35.6582536,E139.7443415,Z15]
[N35.6582536,E139.7443415 東京タワー]
```

出力: 地図が埋め込まれて表示される。

#### 4.9.2

Location記法の構文:

- `N{緯度}`: 北緯（必須）
- `E{経度}`: 東経（必須）
- `Z{ズームレベル}`: ズームレベル（オプション）
- 表示名（オプション）

順序は自由であり、表示名は座標情報の前後どちらでも良い。

### 4.10 文字装飾: 強調

#### 4.10.1

二重ブラケット `[[text]]` で囲まれたテキストは**強調** (strong) として扱われる。

**Example 26:**

入力:

```txt
[[強調されたテキスト]]
```

出力: 太字で表示される。

#### 4.10.2

ブラケット内で `*` (U+002A ASTERISK) を接頭辞として使用することで、テキストを強調できる。`*` の数が多いほど、文字サイズが大きくなる。

**Example 27:**

入力:

```txt
[* レベル1]
[** レベル2]
[*** レベル3]
[**** レベル4]
```

出力: それぞれ異なる大きさの太字テキスト。

#### 4.10.3

行頭で使用された場合の `[*` は、段落全体を大きく表示する。文中で使用された場合は、その部分のみを強調する。

### 4.11 文字装飾: 斜体

#### 4.11.1

ブラケット内で `/` (U+002F SOLIDUS) を接頭辞として使用することで、**斜体** (italic) になる。

**Example 28:**

入力:

```txt
[/ 斜体テキスト]
```

出力: 斜体で表示される。

#### 4.11.2

装飾記号は組み合わせることができる。

**Example 29:**

入力:

```txt
[/* 強調斜体]
[/** さらに大きな強調斜体]
```

出力: 太字かつ斜体で表示される。

### 4.12 文字装飾: 打ち消し線

#### 4.12.1

ブラケット内で `-` (U+002D HYPHEN-MINUS) を接頭辞として使用することで、**打ち消し線** (strikethrough) が付く。

**Example 30:**

入力:

```txt
[- 打ち消されたテキスト]
```

出力: 打ち消し線が引かれる。

#### 4.12.2

他の装飾と組み合わせ可能。

**Example 31:**

入力:

```txt
[-/* 打ち消し斜体強調]
```

出力: 打ち消し線、斜体、太字が適用される。

### 4.13 文字装飾: 下線

#### 4.13.1

ブラケット内で `_` (U+005F LOW LINE) を接頭辞として使用することで、**下線** (underline) が付く。

**Example 32:**

入力:

```txt
[_ 下線付きテキスト]
```

出力: 下線が引かれる。

### 4.14 文字装飾: カラー背景

#### 4.14.1

以下の記号を接頭辞として使用することで、背景色を変更できる:

- `!` (U+0021): 赤背景
- `#` (U+0023): 緑背景（注: 行頭の `#` はハッシュタグとして扱われるため、文中でのみ有効）
- `%` (U+0025): 青背景

**Example 33:**

入力:

```txt
[! 重要]
[# 成功]
[% 情報]
```

出力: それぞれ異なる背景色で表示される。

### 4.15 文字装飾: 拡張記号

#### 4.15.1

UserCSSが有効な場合、以下の記号も装飾記号として使用できる:

```txt
" & ' ( ) + , . / { | } < > ~ 
```

#### 4.15.2

これらの記号は CSS クラス `deco-{symbol}` として出力され、UserCSS でスタイルをカスタマイズできる。

**Example 34:**

入力:

```txt
[{ 吹き出し左]
[} 吹き出し右]
```

出力: UserCSS で定義されたスタイルが適用される。

#### 4.15.3

注意: `=` (U+003D EQUALS SIGN) は将来の使用のために予約されており、使用すべきではない。

### 4.16 インラインコード

#### 4.16.1

バッククォート `` ` `` (U+0060 GRAVE ACCENT) で囲まれたテキストは**インラインコード** (inline code) として扱われる。

**Example 35:**

入力:

```txt
これは `code` です。
```

出力: `code` の部分がコードスタイルで表示される。

#### 4.16.2

バッククォート内では、他のScrapbox記法は処理されない。

### 4.17 インライン数式

#### 4.17.1

ブラケット内で `$` (U+0024 DOLLAR SIGN) を接頭辞として使用し、空白文字で終わる場合、それは**インライン数式** (inline math) として扱われる。

**Example 36:**

入力:

```txt
[$ E = mc^2 ]
```

出力: レンダリングされた数式として表示される。

#### 4.17.2

数式内に `]` を含める場合は、終端の `]` の前に空白文字が必要である。

**Example 37:**

入力:

```txt
[$ [a, b] ]
```

出力: 区間記法 [a, b] が数式として表示される。

#### 4.17.3

数式内では TeX/LaTeX 記法が使用できる。

### 4.18 装飾の組み合わせ規則

#### 4.18.1

複数の装飾記号を組み合わせる場合、記号の順序は任意である。

**Example 38:**

入力:

```txt
[*/-_ 複合装飾]
[-/*_ 複合装飾]
```

出力: 同じ結果（太字、斜体、打ち消し線、下線が全て適用される）。

#### 4.18.2

装飾記号と装飾対象テキストの間に空白文字が必要である。

**Example 39:**

入力:

```txt
[* テキスト]  ← 正しい
[*テキスト]   ← 装飾として認識されない可能性がある
```

## 5 パース優先順位

### 5.1

ブラケット内のテキストは、以下の優先順位で評価される:

1. Location記法 (`N{lat},E{lon}` を含む)
2. インライン数式 (`$` で始まる)
3. 画像URL (画像拡張子を持つURL、またはGyazo URL)
4. 外部リンク (`http://` または `https://` で始まる)
5. アイコン記法 (`.icon` で終わる)
6. クロスプロジェクトリンク (`/` で始まる)
7. フラグメント付きページリンク (`#` を含む)
8. 文字装飾 (装飾記号で始まる)
9. ページリンク (上記のいずれにも該当しない)

### 5.2

ブラケット内に複数の要素が空白文字で区切られて存在する場合:

1. URLと画像URLの組み合わせ → リンク付き画像
2. URLとテキストの組み合わせ → 表示テキスト付き外部リンク
3. Location記法の構成要素 → Location記法
4. その他 → ページリンク

## 6 エスケープと特殊な動作

### 6.1

Scrapboxには明示的なエスケープ機構は存在しない。

### 6.2

ブラケット内のテキストが特定のパターンに一致しない場合、通常のページリンクとして扱われる。これにより、意図しない解釈を避けることができる。

### 6.3

インラインコード `` `...` `` およびコードブロック内では、すべてのScrapbox記法が無効化され、リテラルテキストとして扱われる。

## 7 空白文字の扱い

### 7.1

行頭の空白文字は、箇条書きのインデントレベルを決定するために使用される。

### 7.2

ブラケット内の先頭と末尾の空白文字は、多くの場合無視される。ただし、インライン数式など一部の記法では意味を持つ。

### 7.3

ブラケット内の連続する空白文字は、要素の区切りとして機能する（外部リンク、リンク付き画像など）。

## 8 セマンティック動作

### 8.1 関連ページリスト

#### 8.1.1

各ページにリンクされているページと、そのページからリンクしているページは、**関連ページリスト** (related pages list) に自動的に集約される。

#### 8.1.2

ページリンクとハッシュタグは、どちらも関連ページリストに反映される。

#### 8.1.3

ページが存在しない場合（空リンク）でも、関連性は記録される。

### 8.2 ページタイトル画像

#### 8.2.1

ページ内で最初に出現する画像が、そのページの**ページタイトル画像** (page title image) として扱われる。

#### 8.2.2

ページタイトル画像は、以下の場所で使用される:

- ページリスト
- 関連ページリスト
- アイコン記法

### 8.3 リンクの自動更新

#### 8.3.1

ページタイトルが変更された場合、そのページへのすべてのリンクは自動的に更新される。これにより、リンク切れが発生しない。

## 9 実装における注意事項

### 9.1

本仕様書は、Scrapbox公式の動作を観察した結果に基づいているが、一部の詳細な動作については明示的に文書化されていない可能性がある。

### 9.2

Notion等の他システムへの変換を行う場合、対象システムの制限により、完全な再現ができない場合がある（例: 箇条書きのネスト制限、テーブルのサポートなど）。

### 9.3

UserCSSや外部サービス連携（Gyazo、Mermaidなど）は、実装によって利用可能性が異なる。

## 付録 A: 用語集

- **ブラケット** (bracket): `[` と `]` で囲まれた構文要素
- **ページリンク** (page link): 同一プロジェクト内の他のページへのリンク
- **空リンク** (empty link): リンク先のページが存在しないリンク
- **クロスプロジェクトリンク** (cross-project link): 他のプロジェクトのページへのリンク
- **フラグメント** (fragment): ページ内の特定位置への参照
- **アイコン記法** (icon notation): ページタイトル画像をインラインで表示する記法
- **関連ページリスト** (related pages list): リンク関係に基づいて自動生成されるページリスト
- **ページタイトル画像** (page title image): ページ内の最初の画像で、ページを代表する画像

## 付録 B: 参考資料

- Scrapbox公式ヘルプ: <https://scrapbox.io/help-jp/>
- Cosense製品情報: <https://scrapbox.io/product>
- Gyazo: <https://gyazo.com>
- Mermaid: <https://mermaid.js.org/>
- Helpfeel: <https://helpfeel.com/>

## 付録 C: EBNF文法

以下は、Scrapbox記法の主要部分を EBNF 風の記法で表現した非公式な文法定義である。不完全である可能性がある。

```ebnf
document        = line*

line            = indent? content EOL
indent          = (SPACE | TAB)+
content         = bullet_item | code_block_header | table_header | quote | callout | command | paragraph
bullet_item     = text
code_block_header = "code:" identifier
table_header    = "table:" identifier
quote           = ">" SPACE text
callout         = "?" SPACE text
command         = ("$" | "%") text
paragraph       = text

text            = (bracket | inline_code | plain_text)*
bracket         = "[" bracket_content "]"
bracket_content = location | inline_math | image | link | icon | decoration | page_link

location        = location_coords (SPACE text)? | text SPACE location_coords
location_coords = "N" number "," "E" number ("," "Z" number)?
inline_math     = "$" tex_expression SPACE
image           = image_url | "[[" image_url "]]"
link            = url (SPACE text)? | text SPACE url
icon            = page_ref ".icon" ("*" digit+)?
decoration      = decoration_symbol+ SPACE text
page_link       = page_ref ("#" fragment)?
page_ref        = ("/" project_name "/")? page_name

inline_code     = "`" code_text "`"

url             = ("http://" | "https://") url_chars+
image_url       = url ("." image_ext) | gyazo_url
gyazo_url       = "https://gyazo.com/" id | "https://i.gyazo.com/" id "." image_ext
image_ext       = "png" | "jpg" | "jpeg" | "gif" | "svg" | "webp"

decoration_symbol = "*" | "/" | "-" | "_" | "!" | "#" | "%" | "{" | "}" | ...

EOL             = "\n"
SPACE           = " "
TAB             = "\t"
```
